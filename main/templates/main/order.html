{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ‚Äî Vibrant Store</title>
  <link rel="stylesheet" href="{% static 'main/css/main_two.css' %}">
  <style>
    /* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    .order-container {
      width: 90%;
      max-width: 1200px;
      margin: 50px auto;
      padding: 30px;
      background: #f9fdff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    .order-container h1 {
      text-align: center;
      color: #00ccff;
      margin-bottom: 30px;
    }

    /* === —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–∞ === */
    .summary {
      overflow: hidden;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      margin-bottom: 40px;
    }
    .summary table {
      width: 100%;
      border-collapse: collapse;
    }
    .summary thead th {
      background: #e3f7ff;
      color: #333;
      font-weight: 600;
      padding: 12px;
      text-align: left;
    }
    .summary tbody tr:nth-child(even) {
      background: #f9fdff;
    }
    .summary tbody td {
      padding: 12px;
      border-bottom: 1px solid #eee;
    }
    .summary tfoot th {
      padding: 12px;
      font-size: 1.1em;
    }

    /* === —Å–∞–º–æ–≤—ã–≤–æ–∑ + –æ–ø–ª–∞—Ç–∞ + –∫–∞—Ä—Ç–∞ === */
    .pickup-payment-wrapper {
      display: flex;
      gap: 40px;
      margin-bottom: 40px;
      align-items: flex-start;
    }
    .pickup-payment-left {
      flex: 1;
    }
    .pickup-payment-left h2 {
      margin-bottom: 15px;
    }
    .pickup-list {
      list-style: none;
      padding: 0;
      margin-bottom: 30px;
    }
    .pickup-list li {
      margin-bottom: 12px;
    }
    .pickup-list input {
      margin-right: 8px;
    }
    /* —Å–±—Ä–æ—Å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –±–ª–æ–∫–∞ –æ–ø–ª–∞—Ç—ã */
    .payment {
      margin: 0;
      padding: 0;
      background: none;
      border: none;
    }
    .payment h2 {
      margin-bottom: 10px;
    }
    .payment label {
      display: block;
      margin-bottom: 10px;
      cursor: pointer;
    }
    .payment input {
      margin-right: 8px;
    }

    .pickup-payment-right {
      flex: 1;
      min-width: 300px;
    }
    .pickup-payment-right .map {
      width: 100%;
      height: 300px;
      border-radius: 8px;
    }

    /* –∫–Ω–æ–ø–∫–∞ */
    .btn-order {
      display: block;
      width: 100%;
      padding: 14px;
      background: #00ccff;
      color: #fff;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background .3s;
      margin-top: 20px;
    }
    .btn-order:hover {
      background: #ff99cc;
    }
  </style>
</head>
<body>

<!--     Header -->
<header class="header">
  <a href="{% url 'index' %}" class="logo" style="text-decoration: none; color: #00ccff;">vibrant.</a>

  <div class="search-bar">
    <form action="{% url 'search_results' %}" method="GET">
        <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫..." value="{{ request.GET.q }}">
        <button type="submit">–ò—Å–∫–∞—Ç—å</button>
    </form>
</div>
  <div class="icons">
    {% if user.is_authenticated %}
      <span class="cart-btn">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}!</span>
      <form action="{% url 'logout' %}" method="post" style="display: inline; margin: 0;">
        {% csrf_token %}
        <button type="submit" class="cart-btn">üö™ –í—ã–π—Ç–∏</button>
      </form>
    {% else %}
      <a href="{% url 'login' %}" class="cart-btn">üë§ –í—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a> <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º cart-btn -->
    {% endif %}
    {% if user.is_authenticated %}
  <a href="{% url 'profile' %}"><button class="cart-btn">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button></a>
{% endif %}
    <a href="{% url 'cart' %}">
    <button class="cart-btn">üõí –ö–æ—Ä–∑–∏–Ω–∞</button>
</a>
  </div>
</header>

  <!-- Main Content -->
  <main class="order-container">
    <h1>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h1>

    <!-- –°–≤–æ–¥–∫–∞ –∑–∞–∫–∞–∑–∞ -->
    <section class="summary">
      <h2>–í–∞—à –∑–∞–∫–∞–∑</h2>

      <table>
        <thead>
          <tr><th>–¢–æ–≤–∞—Ä</th><th>–ö–æ–ª-–≤–æ</th><th>–¶–µ–Ω–∞ (‚ÇΩ)</th></tr>
        </thead>
        <tbody>
          {% for item in cart_items %}
          <tr>
            <td>{{ item.product.name }}</td>
            <td>{{ item.quantity }}</td>
            <td>{{ item.total_price|floatformat:2 }}</td>
          </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <th colspan="2">–ò—Ç–æ–≥–æ</th>
            <th>{{ total_price|floatformat:2 }} ‚ÇΩ</th>
          </tr>
        </tfoot>
      </table>
    </section>

    <form method="post">{% csrf_token %}
      <div class="pickup-payment-wrapper">
        <!-- –ª–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="pickup-payment-left">
          <!-- –ü—É–Ω–∫—Ç —Å–∞–º–æ–≤—ã–≤–æ–∑–∞ -->
          <div class="pickup-info">
            <h2>–ü—É–Ω–∫—Ç —Å–∞–º–æ–≤—ã–≤–æ–∑–∞</h2>
            <ul class="pickup-list">
              {% for p in pickup_points %}
              <li>
                <label>
                  <input
                    type="radio"
                    name="pickup_location"
                    value="{{ p.label }}"
                    {% if forloop.first %}checked{% endif %}
                  >
                  <strong>{{ p.label }}</strong>
                  (—á–∞—Å—ã —Ä–∞–±–æ—Ç—ã {{ p.hours }})
                </label>
              </li>
              {% endfor %}
            </ul>
          </div>
          <!-- –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã -->
          <div class="payment">
            <h2>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</h2>
            <label>
              <input type="radio" name="payment_method" value="cash" checked>
              –ù–∞–ª–∏—á–Ω—ã–º–∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏
            </label>
            <label>
              <input type="radio" name="payment_method" value="card">
              –ö–∞—Ä—Ç–æ–π –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏
            </label>
          </div>
        </div>
        <!-- –ø—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –∫–∞—Ä—Ç–∞ -->
        <div class="pickup-payment-right">
          <div id="map" class="map"></div>
        </div>
      </div>

      <button type="submit" class="btn-order">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </form>
  </main>

  <!-- Footer -->
<footer class="footer">
  <div class="footer-content">
    <div class="logo">vibrant.</div>
    <nav class="footer-nav">
      <a href="{% url 'about' %}" class="about-link">–û –Ω–∞—Å</a>
    </nav>
    <nav class="footer-nav">
      <a>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä: 8 495 502-19-44 (9:00 - 21:00) –±–µ–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö</a>
    </nav>
    <div id="shop-status"></div> <!-- üëà –ù–æ–≤—ã–π –±–ª–æ–∫ -->
  </div>
</footer>

  <!-- –°–∫—Ä–∏–ø—Ç —Å—Ç–∞—Ç—É—Å–∞ –º–∞–≥–∞–∑–∏–Ω–∞ -->
  <script>
    function updateShopStatus() {
      const h = new Date().getHours();
      const el = document.getElementById("shop-status");
      if (h >= 9 && h < 21) {
        el.textContent = "üü¢ –ú–∞–≥–∞–∑–∏–Ω –æ—Ç–∫—Ä—ã—Ç";
        el.style.color = "green";
      } else {
        el.textContent = "üî¥ –ú–∞–≥–∞–∑–∏–Ω –∑–∞–∫—Ä—ã—Ç";
        el.style.color = "red";
      }
    }
    document.addEventListener("DOMContentLoaded", updateShopStatus);
  </script>

  <!-- –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã -->
  <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU"></script>
  <script>
    ymaps.ready(() => {
      const map = new ymaps.Map("map", {
        center: [55.751574, 37.573856],
        zoom: 10
      });
      const points = {{ pickup_points|safe }};
      points.forEach(p => {
        map.geoObjects.add(new ymaps.Placemark(p.coords, {
          balloonContent: p.label
        }));
      });
    });
  </script>
</body>
</html>
