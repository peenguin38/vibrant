{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vibrant Store</title>
  <link rel="stylesheet" href="{% static 'main/css/tv.css' %}">
</head>
<!--     Header -->
<header class="header">
  <a href="{% url 'index' %}" class="logo" style="text-decoration: none; color: #00ccff;">vibrant.</a>

  <div class="search-bar">
    <form action="{% url 'search_results' %}" method="GET">
        <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫..." value="{{ request.GET.q }}">
        <button type="submit">–ò—Å–∫–∞—Ç—å</button>
    </form>
</div>
  <div class="icons">
    {% if user.is_authenticated %}
      <span class="cart-btn">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}!</span>
      <form action="{% url 'logout' %}" method="post" style="display: inline; margin: 0;">
        {% csrf_token %}
        <button type="submit" class="cart-btn">üö™ –í—ã–π—Ç–∏</button>
      </form>
    {% else %}
      <a href="{% url 'login' %}" class="cart-btn">üë§ –í—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a> <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º cart-btn -->
    {% endif %}
    {% if user.is_authenticated %}
  <a href="{% url 'profile' %}"><button class="cart-btn">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button></a>
{% endif %}
    <a href="{% url 'cart' %}">
    <button class="cart-btn">üõí –ö–æ—Ä–∑–∏–Ω–∞</button>
</a>
  </div>
</header>

    <!-- Categories -->
<nav class="categories">
    {% for cat in categories %}
        <a href="{% url 'category_products' cat.slug %}">
            <button>{{ cat.name }}</button>
        </a>
    {% endfor %}
</nav>

    <!-- Main Content -->
<br>
<br>
<br>
<br>
<br>
    <main>

<div class="product-card-container">
    {% for product in products %}
    <a href="{% url 'product_detail' product.id %}" class="product-card">
        <img src="{{ product.image.url }}" alt="{{ product.name }}">
        <h3>{{ product.name }}</h3>
        <p><p>{{ product.base_price }} ‚ÇΩ</p>
        <button type="button" onclick="event.preventDefault(); addToCart({{ product.id }})">
            –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
        </button>
    </a>  {% empty %}
    <div class="no-products">
            <h2>–ü—Ä–æ–¥—É–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω</h2>

        <img src="{% static 'main/img/not_found.png' %}" alt="–û –º–∞–≥–∞–∑–∏–Ω–µ vibrant" style="width: 500px; border-radius: 8px;">
        </div>
    {% endfor %}
</div>
    </main>

<br>
<br>
<br>
<br>
<br>
<br>

  <!-- Footer -->
<footer class="footer">
  <div class="footer-content">
    <div class="logo">vibrant.</div>
    <nav class="footer-nav">
      <a href="{% url 'about' %}" class="about-link">–û –Ω–∞—Å</a>
    </nav>
    <nav class="footer-nav">
      <a>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä: 8 495 502-19-44 (9:00 - 21:00) –±–µ–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö</a>
    </nav>
    <div id="shop-status"></div> <!-- üëà –ù–æ–≤—ã–π –±–ª–æ–∫ -->
  </div>
</footer>
<script>
    function addToCart(productId) {
        fetch("{% url 'add_to_cart' 0 %}".replace('0', productId), {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: JSON.stringify({ product_id: productId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === "redirect") {
                window.location.href = "{% url 'register' %}";
            } else if (data.status === "success") {
                alert("–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!");
            } else {
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞.");
            }
        })
        .catch(error => console.error("–û—à–∏–±–∫–∞:", error));
    }

  function updateShopStatus() {
    const now = new Date();
    const hours = now.getHours();

    const statusElement = document.getElementById("shop-status");

    if (hours >= 9 && hours < 21) {
      statusElement.textContent = "üü¢ –ú–∞–≥–∞–∑–∏–Ω –æ—Ç–∫—Ä—ã—Ç";
      statusElement.style.color = "green";
    } else {
      statusElement.textContent = "üî¥ –ú–∞–≥–∞–∑–∏–Ω –∑–∞–∫—Ä—ã—Ç";
      statusElement.style.color = "red";
    }
  }

  document.addEventListener("DOMContentLoaded", updateShopStatus);

</script>
</body>
</html>


