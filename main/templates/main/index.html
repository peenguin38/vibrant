{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vibrant Store</title>
  <link rel="stylesheet" href="{% static 'main/css/main.css' %}">
  <link rel="stylesheet" href="{% static 'main/css/tv.css' %}">
</head>
<!--     Header -->
<header class="header">
  <a href="{% url 'index' %}" class="logo" style="text-decoration: none; color: #00ccff;">vibrant.</a>

  <div class="search-bar">
    <form action="{% url 'search_results' %}" method="GET">
        <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫..." value="{{ request.GET.q }}">
        <button type="submit">–ò—Å–∫–∞—Ç—å</button>
    </form>
</div>
  <div class="icons">
    {% if user.is_authenticated %}
      <span class="cart-btn">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}!</span>
      <form action="{% url 'logout' %}" method="post" style="display: inline; margin: 0;">
        {% csrf_token %}
        <button type="submit" class="cart-btn">üö™ –í—ã–π—Ç–∏</button>
      </form>
    {% else %}
      <a href="{% url 'login' %}" class="cart-btn">üë§ –í—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
    {% endif %}
    {% if user.is_authenticated %}
  <a href="{% url 'profile' %}"><button class="cart-btn">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button></a>
{% endif %}
    <a href="{% url 'cart' %}">
    <button class="cart-btn">üõí –ö–æ—Ä–∑–∏–Ω–∞</button>
</a>
  </div>
</header>
<body>
{% if birthday_today and birthday_promo %}
<div style="position: fixed; bottom: 30px; right: 30px; background: #fff; border: 2px solid #00ccff; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 9999;">
  <h3>üéâ –° –¥–Ω—ë–º —Ä–æ–∂–¥–µ–Ω–∏—è!</h3>
  –í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥: <strong>{{ birthday_promo.code }}</strong>
  <p>–°–∫–∏–¥–∫–∞: {{ birthday_promo.discount_percent }}%</p>
</div>
{% endif %}


{% csrf_token %}



<section class="banner">
  <div class="banner-content">
    <h1>Mac mini <span>M4</span></h1>
    <p class="subtext">–£–∂–µ –≤ –ø—Ä–æ–¥–∞–∂–µ</p>
  </div>
  <div class="banner-photo">
    {% if macmini %}
      <a href="{% url 'product_detail' macmini.id %}">
        <img src="{% static 'main/img/macmini.png' %}" alt="Mac mini" class="main-photo">
      </a>
    {% else %}
      <img src="{% static 'main/img/macmini.png' %}" alt="Mac mini" class="main-photo">
    {% endif %}
  </div>
</section>


    <!-- Categories Section -->
    <div class="category-section">
      <h2 class="category-title">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤</h2>
      <div class="category-buttons">
        {% for category in categories %}
          <a href="{% url 'category_products' category.slug %}">
            <button class="category-btn">{{ category.name }}</button>
          </a>
        {% endfor %}
      </div>
    </div>

<div class="category-section">
  <h2 class="category-title">–ù–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã</h2>
  <div class="product-card-container">
    {% for product in latest_products %}
      <a href="{% url 'product_detail' product.id %}" class="product-card">
        <img src="{{ product.image.url }}" alt="{{ product.name }}">
        <div class="product-content">
          <h3>{{ product.name }}</h3>
          <p>{{ product.base_price }} ‚ÇΩ</p>
        </div>
        {% if user.is_authenticated %}
  <button type="button" onclick="event.preventDefault(); addToCart({{ product.id }})">
    –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
  </button>
{% else %}
  <button type="button" onclick="event.preventDefault(); showToast('–¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç')">
    –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
  </button>
{% endif %}
      </a>
    {% endfor %}
  </div>
</div>
<br>
<br>
<div class="flash-message-container">
  <div id="cart-toast" class="flash-message" style="display: none;">
    <span id="cart-toast-text"></span>
    <span class="close" onclick="this.parentElement.style.display='none'">√ó</span>
  </div>
</div>


    <!-- Footer -->
<footer class="footer">
  <div class="footer-content">
    <div class="logo">vibrant.</div>
    <nav class="footer-nav">
      <a href="{% url 'about' %}" class="about-link">–û –Ω–∞—Å</a>
    </nav>
    <nav class="footer-nav">
      <a>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä: 8 495 502-19-44 (9:00 - 21:00) –±–µ–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö</a>
    </nav>
    <div id="shop-status"></div> <!-- üëà –ù–æ–≤—ã–π –±–ª–æ–∫ -->
  </div>
</footer>
    <script src="{% static 'main/jquery/jquery.slim.min.js' %}"></script>
    <script src="{% static 'main/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<script>
 function updateShopStatus() {
    const now = new Date();
    const hours = now.getHours();

    const statusElement = document.getElementById("shop-status");

    if (hours >= 9 && hours < 21) {
      statusElement.textContent = "üü¢ –ú–∞–≥–∞–∑–∏–Ω –æ—Ç–∫—Ä—ã—Ç";
      statusElement.style.color = "green";
    } else {
      statusElement.textContent = "üî¥ –ú–∞–≥–∞–∑–∏–Ω –∑–∞–∫—Ä—ã—Ç";
      statusElement.style.color = "red";
    }
  }

  document.addEventListener("DOMContentLoaded", updateShopStatus);

function showToast(message) {
  const toast = document.getElementById('cart-toast');
  const toastText = document.getElementById('cart-toast-text');

  toastText.innerText = message;
  toast.style.display = 'flex';
  toast.style.opacity = '1';

  setTimeout(() => {
    toast.style.opacity = '0';
    setTimeout(() => {
      toast.style.display = 'none';
    }, 500);
  }, 4000);
}


function addToCart(productId) {
  const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
  if (!csrfToken) {
    showToast("–¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç");
    return;
  }

  fetch(`/add-to-cart/${productId}/`, {
    method: 'POST',
    headers: {
      'X-CSRFToken': csrfToken.value,
      'Content-Type': 'application/x-www-form-urlencoded',
    },
    body: ""
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === 'success') {
      showToast("–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É");
    } else {
      showToast(data.message || "–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏");
    }
  })
  .catch(() => {
    showToast("–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É");
  });
}
</script>
</body>
</html>
